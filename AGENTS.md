# AGENTS

## Repository Overview
- Language: Coq/Rocq (`*.v`) with a small Python helper in `scripts/`.
- Logical library path: `SN` (from `_RocqProject`).
- Build system: `Makefile` generated by `rocq makefile` from `_RocqProject`.
- Main modules: `base.v`, `equiv.v`, `add.v`, `add_facts.v`, `pseudo.v`, `exercises.v`.
- Generated artifacts (`*.vo`, `*.glob`, `*.vok`, `*.vos`, `*.aux`) are ignored.

## Build / Lint / Test Commands
Coq compilation is the primary check; there is no separate lint runner.

### Build all
```sh
make
```

### Build a single file (single-test equivalent)
```sh
make base.vo
```
Alternative (direct compiler, same flags as `_RocqProject`):
```sh
rocq compile -Q . SN base.v
```

### Build a specific list of targets
```sh
make TGTS="base.vo equiv.vo" only
```

### Validate compiled artifacts
Runs `rocqchk` on all `.vo` files.
```sh
make validate
```

### Faster compile variants
```sh
make vos     # build .vos only
make vok     # build .vok only
```

### Bytecode / native variants
```sh
make byte
make opt
```

### Generate assumptions report
Requires `.glob` files (build first).
```sh
make assumptions
```

### Interactive REPL (ad hoc checks)
```sh
rocq repl -Q . SN
```
Example session:
```coq
From SN Require Import base.
Check sle_refl.
```

### Documentation (optional)
```sh
make html
```

### Clean
```sh
make clean
make cleanall
```

### Regenerate Makefile after changing `_RocqProject`
```sh
rocq makefile -f _RocqProject -o Makefile
```

## Code Style Guidelines
### Coq / Rocq
- Imports:
  - Use `From Stdlib Require Import ...` first; keep `Utf8_core` in files that use Unicode notations.
  - Import project modules with `From SN Require Import ...` after Stdlib imports.
  - Add `Classical` only in files that need them; keep scope local.
- Notations and scopes:
  - Keep custom notation in `surreal_scope` and open it explicitly when needed.
  - Prefer existing notations for relations and operators (`≤`, `≱`, `≡`, `∪`, `+`, `-`).
  - When adding a new notation, mirror the style in `base.v`/`equiv.v` and reserve it if it conflicts.
- Definitions and types:
  - Use `Definition`/`Fixpoint` for constructions, `Lemma`/`Theorem`/`Corollary` for proofs.
  - Match the left/right naming pattern: `Lx`, `Rx`, `lx`, `rx`, `Ly`, `Ry`, `ly`, `ry`.
  - Prefer explicit `∀` quantification and give type annotations for functions.
  - Use `Qed` for opaque proofs and `Defined` only when computational content matters.
- Proof style:
  - Keep `Proof.`/`Qed.` (or `Defined.`) on their own lines.
  - Use existing tactics (`inv`, `sinv`, `solve_snge`) for `≤`/`≱` inversions.
  - Prefer `cbn [name]` or targeted `rewrite` over large `simpl` calls.
  - Use `Hint Resolve` / `Hint Unfold` sparingly; put them in the smallest hint database (`core` or `surreal`).
  - Avoid `Admitted` or `Abort` in committed proofs; reserve them for exercises and mark clearly.
- Relations and morphisms:
  - When adding new equivalence relations, also add `Add Relation`/`Add Morphism` entries.
  - Ensure morphisms use `seq`/`eqs` consistently with existing conventions.
- Formatting:
  - Use 2-space indentation inside matches, records, and proofs.
  - Align `|` branches and keep long definitions wrapped similar to existing files.
  - Keep Unicode operators consistent with `Utf8_core`; do not mix ASCII alternatives.
- Modules:
  - Use `Module ... End ...` blocks to isolate exercises/examples (see `exercises.v`).
  - Avoid global definitions in exercise modules unless they are reused elsewhere.

## Project Conventions
- Logical module path is `SN`; imports should look like `From SN Require Import base`.
- Source list lives in `_RocqProject`; update it when adding/removing `.v` files.
- `Makefile` and `Makefile.conf` are generated; do not edit them directly.
- Build artifacts (`*.vo`, `*.glob`, `*.vok`, `*.vos`, `*.aux`) should not be committed.
- Use `make assumptions` to review proof assumptions/axioms when needed.

## Quick File Map
- `_RocqProject`: project files and logical load paths.
- `Makefile`: generated build rules (Rocq 9.1-style).
- `Makefile.local-late`: local targets (`assumptions`) and clean hooks.
- `base.v`: core surreal definitions, order relations, and foundational lemmas.
- `equiv.v`: equivalence relations and set-level equality.
- `add.v`: addition, subtraction, negation, and algebraic laws.
- `add_facts.v`: additional algebraic facts.
- `pseudo.v`: pseudo-number examples and classical results.
- `exercises.v`: exercise modules and notes.

## Notes for Agentic Changes
- Keep new `.v` files consistent with the existing notation-heavy style.
- If you add new dependencies, update `_RocqProject` and regenerate `Makefile`.
- For new proofs, prefer constructive arguments unless `Classical` is already imported.
- When using classical axioms, document the reason in a short comment near the import.
- When adding new helper tactics, define them near similar tactics in `base.v`.
- Avoid editing `Makefile.conf` unless regenerating via `rocq makefile`.
- Introduce new scripts in `scripts/`.
